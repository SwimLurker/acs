<table id="dg" class="easyui-datagrid" style="height:auto;padding: 10px;"
       fit="true" border="true"
       data-options="singleSelect:true,url:'/webconsole/rest/sessions/',method:'GET',toolbar:'#toolbar',pagination:true,onDblClickRow: sessionDetail"
       sortName="sessionID" sortOrder="asc"
       idField="sessionID" >
    <thead>
    <tr width="100%" >
        <th field="sessionID" width="100" sortable="true">Session ID</th>
        <th field="deviceKey" width = "100" >deviceKey</th>
        <th field="lastUpdateTime" width="120" sortable="true">Last Update Time</th>
    </tr>
    </thead>

</table>
<div id="toolbar" style="padding:5px;height:auto">
    <div style="margin-bottom:5px">
        <a href="#" class="easyui-linkbutton" iconCls="icon-remove" plain="true" onclick="javascript: removeSession();">Remove Session</a>
        <input type="text" id="sSessionID" />
        <a href="#" class="easyui-linkbutton" iconCls="icon-search" onclick="javascript: searchSession();">Search</a>
    </div>
</div>
<div id="sessionDetailDlg" class="easyui-dialog" title="Session Detail Info" style="width:400px;height:550px;padding:10px 20px" closed="true" buttons="#detaildlg-buttons">
    <div class="ftitle">Session Detail Information</div>
    <form id="fm_detail" method="post">
        <div class="fitem">
            <label>Session ID:</label>
            <input name="sessionID" readonly>
        </div>
        <div class="fitem">
            <label>Device Key:</label>
            <input name="deviceKey" readonly>
        </div>
        <div class="fitem">
            <label>Last Update Time:</label>
            <input name="lastUpdateTime" readonly>
        </div>
    </form>
</div>
<div id="detaildlg-buttons">
    <a href="#" class="easyui-linkbutton" iconCls="icon-close" onclick="javascript:$('#sessionDetailDlg').dialog('close')">Close</a>
</div>
<script type="text/javascript" >
    function removeSession(){
        var row = $('#dg').datagrid('getSelected');
        if (row){
            $.messager.confirm('Confirm','Are you sure you want to remove this session?',
                    function(r){
                        if (r){
                            $.ajax({ url:'/webconsole/rest/sessions/'+ row.sessionID,
                                type:'DELETE',
                                success: function(result){
                                    if (result.success){
                                        $('#dg').datagrid('reload'); // reload the data
                                    } else {
                                        $.messager.show({ // show error message
                                            title: 'Error',
                                            msg: result.msg
                                        });
                                    }
                                }});
                        }
                    });
        }
    }
    function searchSession(){
        $('#dg').datagrid('load',{
            sessionID:$('#sSessionID').val()
        });
    }
    function sessionDetail(rowIndex, row){
        $('#sessionDetailDlg').dialog('open').dialog('setTitle', 'Show Session Detail Info');
        $('#fm_detail').form('load', row);
    }
</script>